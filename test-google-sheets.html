<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Google Sheets Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #555;
            font-size: 18px;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #4f46e5;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .url-info {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 12px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Google Sheets</h1>
        
        <div class="url-info" id="urlInfo">
            –ó–∞–≥—Ä—É–∑–∫–∞ URL...
        </div>

        <div class="test-section">
            <h2>1. –¢–µ—Å—Ç –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)</h2>
            <button onclick="testDistribution()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏</button>
            <div id="result-distribution"></div>
        </div>

        <div class="test-section">
            <h2>2. –¢–µ—Å—Ç –ø—Ä–æ–º–æ (–¥–µ—Ç–∞–ª—å–Ω–æ–µ)</h2>
            <button onclick="testPromoDetailed()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ (–¥–µ—Ç–∞–ª—å–Ω–æ–µ)</button>
            <div id="result-promo-detailed"></div>
        </div>

        <div class="test-section">
            <h2>3. –¢–µ—Å—Ç –ø—Ä–æ–º–æ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ)</h2>
            <button onclick="testPromoWeekly()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ)</button>
            <div id="result-promo-weekly"></div>
        </div>

        <div class="test-section">
            <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ URL —Å–∫—Ä–∏–ø—Ç–∞</h2>
            <button onclick="checkUrl()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL</button>
            <div id="result-url"></div>
        </div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbzXO-i9scK4c61XUiuqQWl90I1BTgtiIgpm3UR6dBF9fuzatXkDPZ3YJffxuPmWt9GPDA/exec';
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –≤ window –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.VITE_GOOGLE_SCRIPT_URL = scriptUrl;
        
        document.getElementById('urlInfo').textContent = `URL —Å–∫—Ä–∏–ø—Ç–∞: ${scriptUrl}`;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL
        async function getGoogleScriptUrl() {
            if (window.VITE_GOOGLE_SCRIPT_URL) {
                return window.VITE_GOOGLE_SCRIPT_URL;
            }
            
            try {
                const res = await fetch('/config.json', { cache: 'no-store' });
                if (res.ok) {
                    const obj = await res.json();
                    if (obj && obj.VITE_GOOGLE_SCRIPT_URL) {
                        return obj.VITE_GOOGLE_SCRIPT_URL;
                    }
                }
            } catch (e) {
                console.error('Error fetching config:', e);
            }
            
            return '';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏
        function prepareDistributionData(formData) {
            const tariffMap = {
                '–ë–∞–∑–æ–≤—ã–π': 'basic',
                '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': 'advanced',
                '–ü—Ä–µ–º–∏—É–º': 'premium',
                '–ü–ª–∞—Ç–∏–Ω—É–º': 'platinum',
            };
            
            const releaseTypeMap = {
                'Single': 'single',
                'EP': 'ep',
                'Album': 'album',
            };

            const prices = {
                basic: { single: 500, ep: 700, album: 900 },
                advanced: { single: 690, ep: 890, album: 1200 },
                premium: { single: 1200, ep: 1690, album: 2290 },
                platinum: { single: 4990, ep: 6490, album: 7990 },
            };

            const karaokePrices = {
                basic: 350,
                advanced: 195,
                premium: 140,
                platinum: 0,
            };

            function getTrackCount(data) {
                const type = data.releaseType;
                if (type === 'Single') return data.singleTrackCount === '2' ? 2 : 1;
                if (type === 'EP') return parseInt(data.epTrackCount || '3', 10);
                if (type === 'Album') return parseInt(data.albumTrackCount || '6', 10);
                return 1;
            }

            const tariffRu = formData.tariff || '';
            const tariff = tariffMap[tariffRu] || 'basic';
            const releaseTypeRu = formData.releaseType || '';
            const releaseType = releaseTypeMap[releaseTypeRu] || 'single';
            const trackCount = getTrackCount(formData);
            const addKaraoke = formData.karaokeAddition === '–î–∞';

            const basePrice = prices[tariff]?.[releaseType] || 0;
            const karaokePrice = addKaraoke ? karaokePrices[tariff] * trackCount : 0;
            const totalPrice = basePrice + karaokePrice;

            let tracks = [];
            try {
                if (formData._tracks) {
                    tracks = JSON.parse(formData._tracks);
                }
            } catch (e) {
                console.error('Error parsing tracks:', e);
            }

            const tracksFormatted = tracks.map((track, index) => {
                const artists = (track.artists || [])
                    .map((a, i) => {
                        if (i === 0) return a.name;
                        return a.type === 'feat' ? `feat. ${a.name}` : `, ${a.name}`;
                    })
                    .join('') || '';

                return {
                    number: index + 1,
                    name: track.name || '',
                    version: track.version || '',
                    artists: artists,
                    lyricists: (track.lyricists || []).join(', ') || '',
                    composers: (track.composers || []).join(', ') || '',
                    explicitContent: track.explicitContent || '',
                    substanceMention: track.substanceMention || '',
                    lyrics: track.lyrics || '',
                };
            });

            return {
                formType: 'distribution',
                timestamp: new Date().toISOString(),
                tariff: tariff,
                releaseType: releaseType,
                trackCount: trackCount,
                releaseName: formData.releaseName,
                mainArtist: formData.mainArtist,
                releaseVersion: formData.releaseVersion || '',
                releaseLink: formData.releaseLink,
                genre: formData.genre,
                language: (formData.languageOther || '').trim() || formData.language || '',
                releaseDate: formData.releaseDate,
                coverLink: formData.coverLink,
                tiktokExcerpt: formData.tiktokExcerpt,
                tiktokFull: formData.tiktokFull || '',
                yandexPreSave: formData.yandexPreSave || '',
                addKaraoke: formData.karaokeAddition === '–î–∞' ? 'yes' : 'no',
                tracks: JSON.stringify(tracksFormatted, null, 2),
                fullName: formData.fullName,
                passportNumber: formData.passportNumber,
                issuedBy: formData.issuedBy,
                issueDate: formData.issueDate,
                bankDetails: formData.bankDetails,
                email: formData.email,
                contactInfo: formData.contactInfo,
                artistProfileLinks: formData.artistProfileLinks || '',
                basePrice: basePrice,
                karaokePrice: karaokePrice,
                totalPrice: totalPrice,
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–æ
        function preparePromoData(promoData) {
            const promoType = promoData.promoType;
            
            if (promoType === 'detailed') {
                return {
                    formType: 'promo',
                    timestamp: new Date().toISOString(),
                    promoType: promoData.promoType,
                    releaseLink: promoData.promoReleaseLink || '',
                    upcOrName: promoData.promoUPC || '',
                    releaseDate: promoData.promoReleaseDate || '',
                    genre: promoData.promoGenre || '',
                    focusTrack: promoData.promoFocusTrack || '',
                    additionalInfo: promoData.promoExtra || '',
                    artistAndTitle: promoData.promoArtistTitle || '',
                    releaseDescription: promoData.promoDescription || '',
                    artistInfo: promoData.promoArtistInfo || '',
                    artistPhotos: promoData.promoPhotos || '',
                    socialLinks: promoData.promoSocials || '',
                    contactInfo: promoData.promoContact || '',
                };
            } else if (promoType === 'weekly') {
                return {
                    formType: 'promo',
                    timestamp: new Date().toISOString(),
                    promoType: promoData.promoType,
                    releaseLink: promoData.promoWeeklyReleaseLink || '',
                    upcOrName: promoData.promoWeeklyUPC || '',
                    releaseDate: promoData.promoWeeklyReleaseDate || '',
                    genre: promoData.promoWeeklyGenre || '',
                    focusTrack: promoData.promoWeeklyFocusTrack || '',
                    additionalInfo: promoData.promoWeeklyExtra || '',
                    artistAndTitle: '',
                    releaseDescription: '',
                    artistInfo: '',
                    artistPhotos: '',
                    socialLinks: '',
                    contactInfo: promoData.promoContact || '',
                };
            }
            
            return {
                formType: 'promo',
                timestamp: new Date().toISOString(),
                promoType: promoData.promoType || '',
                releaseLink: '',
                upcOrName: '',
                releaseDate: '',
                genre: '',
                focusTrack: '',
                additionalInfo: '',
                artistAndTitle: '',
                releaseDescription: '',
                artistInfo: '',
                artistPhotos: '',
                socialLinks: '',
                contactInfo: promoData.promoContact || '',
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function submitToGoogleSheets(formType, data) {
            const GOOGLE_SCRIPT_URL = await getGoogleScriptUrl();
            
            if (!GOOGLE_SCRIPT_URL) {
                return {
                    success: false,
                    message: 'Google Script URL not configured',
                };
            }

            const preparedData = formType === 'distribution' 
                ? prepareDistributionData(data)
                : preparePromoData(data);

            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º GET –∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ URL (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ –¥–ª—è Google Apps Script)
                // –ö–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –≤ URL
                const dataString = encodeURIComponent(JSON.stringify(preparedData));
                const url = new URL(GOOGLE_SCRIPT_URL);
                url.searchParams.set('data', dataString);
                
                console.log('Sending data via GET:', {
                    url: url.toString().substring(0, 200) + '...',
                    formType: preparedData.formType,
                    dataLength: dataString.length
                });
                
                const res = await fetch(url.toString(), {
                    method: 'GET',
                    redirect: 'follow',
                });

                const text = await res.text();
                let json = null;
                try {
                    json = text ? JSON.parse(text) : null;
                } catch (parseErr) {
                    json = { success: res.ok, message: text || res.statusText };
                }

                if (!res.ok) {
                    const msg = json && json.error ? json.error : json && json.message ? json.message : `HTTP ${res.status}`;
                    return { success: false, message: `Server error: ${msg}`, response: json };
                }

                if (json && typeof json === 'object') {
                    return {
                        success: !!json.success,
                        message: json.message || '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã',
                        row: json.row,
                        response: json,
                    };
                }

                return { success: true, message: '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã', response: json || text };
            } catch (err) {
                return {
                    success: false,
                    message: err.message || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                    error: err.toString(),
                };
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
        window.testDistribution = async function() {
            const button = event.target;
            const resultDiv = document.getElementById('result-distribution');
            button.disabled = true;
            resultDiv.innerHTML = '<div class="loading"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';

            const testData = {
                tariff: '–ë–∞–∑–æ–≤—ã–π',
                releaseType: 'Single',
                singleTrackCount: '1',
                releaseName: '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ª–∏–∑',
                mainArtist: '–¢–µ—Å—Ç–æ–≤—ã–π –∞—Ä—Ç–∏—Å—Ç',
                releaseLink: 'https://example.com/release',
                genre: 'Pop',
                language: '–†—É—Å—Å–∫–∏–π',
                releaseDate: '2024-12-31',
                coverLink: 'https://example.com/cover.jpg',
                tiktokExcerpt: 'https://example.com/tiktok',
                karaokeAddition: '–ù–µ—Ç',
                fullName: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                passportNumber: '1234 567890',
                issuedBy: '–ú–í–î –†–æ—Å—Å–∏–∏',
                issueDate: '2020-01-01',
                bankDetails: '12345678901234567890',
                email: 'test@example.com',
                contactInfo: '@testuser',
                _tracks: JSON.stringify([
                    {
                        name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç—Ä–µ–∫',
                        version: '',
                        artists: [{ name: '–¢–µ—Å—Ç–æ–≤—ã–π –∞—Ä—Ç–∏—Å—Ç', type: 'main' }],
                        lyricists: ['–ê–≤—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞'],
                        composers: ['–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä'],
                        explicitContent: '–ù–µ—Ç',
                        substanceMention: '–ù–µ—Ç',
                        lyrics: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏',
                    },
                ]),
            };

            const result = await submitToGoogleSheets('distribution', testData);
            
            button.disabled = false;
            resultDiv.innerHTML = `<div class="result ${result.success ? 'success' : 'error'}">
                <strong>${result.success ? '‚úÖ –£—Å–ø–µ—Ö!' : '‚ùå –û—à–∏–±–∫–∞'}</strong><br>
                –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}<br>
                ${result.row ? `–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: ${result.row}<br>` : ''}
                ${result.response ? `–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result.response, null, 2)}` : ''}
                ${result.error ? `–û—à–∏–±–∫–∞: ${result.error}` : ''}
            </div>`;
        };

        window.testPromoDetailed = async function() {
            const button = event.target;
            const resultDiv = document.getElementById('result-promo-detailed');
            button.disabled = true;
            resultDiv.innerHTML = '<div class="loading"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';

            const testData = {
                promoType: 'detailed',
                promoReleaseLink: 'https://example.com/release.wav',
                promoUPC: 'UPC123456789',
                promoReleaseDate: '2024-12-31',
                promoGenre: 'Pop',
                promoFocusTrack: '–§–æ–∫—É—Å —Ç—Ä–µ–∫',
                promoExtra: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ü–∏–∏',
                promoArtistTitle: '–¢–µ—Å—Ç–æ–≤—ã–π –∞—Ä—Ç–∏—Å—Ç - –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ª–∏–∑',
                promoDescription: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞',
                promoArtistInfo: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–æ–≤–æ–º –∞—Ä—Ç–∏—Å—Ç–µ',
                promoPhotos: 'https://example.com/photos.zip',
                promoSocials: 'https://vk.com/testartist',
                promoContact: '@testcontact',
            };

            const result = await submitToGoogleSheets('promo', testData);
            
            button.disabled = false;
            resultDiv.innerHTML = `<div class="result ${result.success ? 'success' : 'error'}">
                <strong>${result.success ? '‚úÖ –£—Å–ø–µ—Ö!' : '‚ùå –û—à–∏–±–∫–∞'}</strong><br>
                –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}<br>
                ${result.row ? `–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: ${result.row}<br>` : ''}
                ${result.response ? `–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result.response, null, 2)}` : ''}
                ${result.error ? `–û—à–∏–±–∫–∞: ${result.error}` : ''}
            </div>`;
        };

        window.testPromoWeekly = async function() {
            const button = event.target;
            const resultDiv = document.getElementById('result-promo-weekly');
            button.disabled = true;
            resultDiv.innerHTML = '<div class="loading"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';

            const testData = {
                promoType: 'weekly',
                promoWeeklyReleaseLink: 'https://example.com/release.wav',
                promoWeeklyUPC: 'UPC987654321',
                promoWeeklyReleaseDate: '2024-12-27',
                promoWeeklyGenre: 'Rock',
                promoWeeklyFocusTrack: '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ç—Ä–µ–∫',
                promoWeeklyExtra: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–æ',
                promoContact: '@weeklycontact',
            };

            const result = await submitToGoogleSheets('promo', testData);
            
            button.disabled = false;
            resultDiv.innerHTML = `<div class="result ${result.success ? 'success' : 'error'}">
                <strong>${result.success ? '‚úÖ –£—Å–ø–µ—Ö!' : '‚ùå –û—à–∏–±–∫–∞'}</strong><br>
                –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}<br>
                ${result.row ? `–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: ${result.row}<br>` : ''}
                ${result.response ? `–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result.response, null, 2)}` : ''}
                ${result.error ? `–û—à–∏–±–∫–∞: ${result.error}` : ''}
            </div>`;
        };

        window.checkUrl = async function() {
            const button = event.target;
            const resultDiv = document.getElementById('result-url');
            button.disabled = true;
            resultDiv.innerHTML = '<div class="loading"></div> –ü—Ä–æ–≤–µ—Ä–∫–∞...';

            const url = await getGoogleScriptUrl();
            
            if (!url) {
                button.disabled = false;
                resultDiv.innerHTML = `<div class="result error">
                    <strong>‚ùå URL –Ω–µ –Ω–∞–π–¥–µ–Ω</strong><br>
                    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env –∏–ª–∏ config.json
                </div>`;
                return;
            }

            try {
                // –ü—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å GET –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
                const res = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow',
                });
                
                const text = await res.text();
                let json = null;
                try {
                    json = JSON.parse(text);
                } catch (e) {
                    // –ù–µ JSON –æ—Ç–≤–µ—Ç - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
                }

                button.disabled = false;
                resultDiv.innerHTML = `<div class="result ${res.ok ? 'success' : 'error'}">
                    <strong>${res.ok ? '‚úÖ URL –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å URL'}</strong><br>
                    –°—Ç–∞—Ç—É—Å: ${res.status} ${res.statusText}<br>
                    URL: ${url}<br>
                    ${json ? `–û—Ç–≤–µ—Ç: ${JSON.stringify(json, null, 2)}` : `–û—Ç–≤–µ—Ç: ${text.substring(0, 200)}`}
                </div>`;
            } catch (err) {
                button.disabled = false;
                resultDiv.innerHTML = `<div class="result error">
                    <strong>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ</strong><br>
                    ${err.message}<br>
                    URL: ${url}
                </div>`;
            }
        };
    </script>
</body>
</html>
